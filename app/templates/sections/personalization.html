<!-- Персонализация -->
{% set dna_testing_data = personalization.get('dna_testing', {}) if personalization.get('dna_testing') is mapping else {} %}
{% set auracloud_data = personalization.get('auracloud', {}) if personalization.get('auracloud') is mapping else {} %}
{% set dna_text = personalization.get('dna_testing', '') if personalization.get('dna_testing') is string else '' %}
{% set auracloud_text = personalization.get('auracloud', '') if personalization.get('auracloud') is string else '' %}

<section id="personalization" class="personalization-section section section-alt">
    <div class="container">
        <div class="section-header" data-aos="fade-up">
            <h2 class="section-title">{{ personalization.get('title', 'Персонализация') }}</h2>
            <p class="section-subtitle">{{ personalization.get('subtitle', '') }}</p>
        </div>
        
        <div class="personalization-content">
            <!-- ДНК-тестирование -->
            <div class="personalization-block" data-aos="fade-right">
                <div class="personalization-visual">
                    {% if dna_testing_data.get('image_url') %}
                    <img src="{{ dna_testing_data.image_url }}" alt="ДНК-тестирование" class="personalization-image">
                    {% else %}
                    <div class="visual-placeholder dna-visual">
                        <svg width="200" height="200" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M100 20L120 60L100 100L80 60L100 20Z" stroke="currentColor" stroke-width="2" fill="none"/>
                            <path d="M100 100L120 140L100 180L80 140L100 100Z" stroke="currentColor" stroke-width="2" fill="none"/>
                            <line x1="80" y1="60" x2="120" y2="60" stroke="currentColor" stroke-width="2"/>
                            <line x1="85" y1="80" x2="115" y2="80" stroke="currentColor" stroke-width="2"/>
                            <line x1="80" y1="140" x2="120" y2="140" stroke="currentColor" stroke-width="2"/>
                            <line x1="85" y1="120" x2="115" y2="120" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    {% endif %}
                </div>
                <div class="personalization-text">
                    <h3 class="personalization-title">{{ dna_testing_data.get('title', 'ДНК-тестирование') }}</h3>
                    <p class="personalization-description">
                        {{ dna_testing_data.get('description', '') or dna_text }}
                    </p>
                    <ul class="personalization-features">
                        {% for feature in dna_testing_data.get('features', []) %}
                        <li>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: #A67C52;">
                            <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                            {{ feature }}
                        </li>
                        {% endfor %}
                    </ul>
                    <a href="#services" class="btn btn-primary">{{ get_content('personalization', 'testing_button', current_locale) or 'Пройти тестирование' }}</a>
                </div>
            </div>
            
            <!-- Разделитель -->
            <div class="personalization-divider" data-aos="fade-up">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: #A67C52;">
                    <path d="M12 2v20M2 12h20" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </div>
            
            <!-- AuraCloud® 3D -->
            <div class="personalization-block personalization-block-reverse" data-aos="fade-left">
                <div class="personalization-visual">
                    {% if auracloud_slider.enabled and auracloud_slider.before_image and auracloud_slider.after_image %}
                    <!-- Интерактивный слайдер До/После -->
                    <div class="before-after-slider" id="auracloudSlider">
                        <div class="slider-container">
                            <div class="slider-image before-image">
                                <img src="{{ auracloud_slider.before_image }}" alt="{{ auracloud_slider.before_label }}" class="slider-img">
                                <div class="slider-label before-label">{{ auracloud_slider.before_label }}</div>
                            </div>
                            <div class="slider-image after-image">
                                <img src="{{ auracloud_slider.after_image }}" alt="{{ auracloud_slider.after_label }}" class="slider-img">
                                <div class="slider-label after-label">{{ auracloud_slider.after_label }}</div>
                            </div>
                            <div class="slider-handle">
                                <div class="slider-line"></div>
                                <div class="slider-button">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8 5l4 4 4-4M8 19l4-4 4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% elif auracloud_data.get('image_url') %}
                    <img src="{{ auracloud_data.image_url }}" alt="AuraCloud 3D" class="personalization-image">
                    {% else %}
                    <div class="visual-placeholder aura-visual">
                        <svg width="200" height="200" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="100" cy="100" r="30" stroke="currentColor" stroke-width="2" opacity="0.8"/>
                            <circle cx="100" cy="100" r="50" stroke="currentColor" stroke-width="2" opacity="0.6"/>
                            <circle cx="100" cy="100" r="70" stroke="currentColor" stroke-width="2" opacity="0.4"/>
                            <circle cx="100" cy="100" r="90" stroke="currentColor" stroke-width="2" opacity="0.2"/>
                            <circle cx="100" cy="100" r="10" fill="currentColor"/>
                        </svg>
                    </div>
                    {% endif %}
                </div>
                <div class="personalization-text">
                    <h3 class="personalization-title">{{ auracloud_data.get('title', 'AuraCloud® 3D') }}</h3>
                    <p class="personalization-description">
                        {{ auracloud_data.get('description', '') or auracloud_text }}
                    </p>
                    <ul class="personalization-features">
                        {% for feature in auracloud_data.get('features', []) %}
                        <li>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: #A67C52;">
                            <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                            {{ feature }}
                        </li>
                        {% endfor %}
                    </ul>
                    <a href="#services" class="btn btn-primary">{{ get_content('personalization', 'testing_button', current_locale) or 'Пройти сканирование' }}</a>
                </div>
            </div>
        </div>
        
        <!-- Информационный блок -->
        <div class="personalization-info" data-aos="fade-up">
            <div class="info-card">
                <h4>{{ personalization.info_text }}</h4>
                <p>{{ personalization.info_description }}</p>
                <a href="{{ personalization.bio_well_url }}" target="_blank" rel="noopener noreferrer" class="info-link">
                    {{ get_content('personalization', 'biowell_button', current_locale) or 'Узнать больше о Bio-Well' }}
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: #A67C52;">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14L21 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</section>




